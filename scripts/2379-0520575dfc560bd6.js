"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2379],{61867:function(e,t,n){n.d(t,{KX:function(){return h},O3:function(){return b},P2:function(){return f},TD:function(){return x},q2:function(){return y},to:function(){return s},vr:function(){return m}});var r,s,o=n(15489),a=n(97712),i=n(3286);(r=s||(s={})).ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",r.SetContent="anthropic.claude.usercontent.sandbox.SetContent",r.GetFile="anthropic.claude.usercontent.sandbox.GetFile",r.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",r.RunCode="anthropic.claude.usercontent.sandbox.RunCode",r.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",r.ReportError="anthropic.claude.usercontent.sandbox.ReportError",r.GetScreenshot="anthropic.claude.usercontent.sandbox.GetScreenshot",r.BroadcastContentSize="anthropic.claude.usercontent.sandbox.BroadcastContentSize";let c=a.z.object({type:a.z.literal("UnsupportedImports"),unsupportedModules:a.z.array(a.z.string()),nonExistentIcons:a.z.array(a.z.string())}),u=a.z.object({type:a.z.literal("RuntimeError"),message:a.z.string()}),l=a.z.object({type:a.z.literal("FileNotFound"),fileName:a.z.string()}),d=a.z.object({type:a.z.literal("ClaudeCompletionError"),message:a.z.string()}),p=a.z.discriminatedUnion("type",[c,u,l,d]),h=a.z.object({code:a.z.string()}),m=a.z.object({status:a.z.enum(["success","error"]),result:a.z.string().optional(),logs:a.z.array(a.z.string()),error:a.z.string().optional()}),g={"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),content:a.z.string(),type:a.z.nativeEnum(o.JP),watchContentSize:a.z.boolean().optional()})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.BroadcastContentSize":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.BroadcastContentSize"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.BroadcastContentSizePayload"),height:a.z.number(),width:a.z.number()})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.z.strictObject({key:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({value:a.z.instanceof(Uint8Array).nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.z.strictObject({message:a.z.string(),messageType:a.z.enum(["text","error"]),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.z.strictObject({code:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(m)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.z.strictObject({prompt:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({completion:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:p})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetScreenshot":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetScreenshot"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({screenshot:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse")})}),alwaysPermitted:!1}},f=a.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError","anthropic.claude.usercontent.sandbox.BroadcastContentSize"]),y=a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,g["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema,g["anthropic.claude.usercontent.sandbox.BroadcastContentSize"].requestSchema]);a.z.union([i.AY,g["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema]),a.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode","anthropic.claude.usercontent.sandbox.GetScreenshot"]),a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].requestSchema]);let b=a.z.union([g["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].responseSchema]),x=Object.entries(g).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},3286:function(e,t,n){n.d(t,{AY:function(){return c},D7:function(){return u},Kj:function(){return i},Tk:function(){return a},Zq:function(){return o},qV:function(){return s},v8:function(){return l}});var r=n(97712);let s=r.z.object({channel:r.z.enum(["request","response"]),requestId:r.z.string()}).passthrough(),o=s.strict().extend({channel:r.z.literal("request"),method:r.z.string(),payload:r.z.strictObject({"@type":r.z.string()})}),a=s.extend({channel:r.z.literal("response"),status:r.z.number().int().min(100).max(599),payload:r.z.strictObject({"@type":r.z.string()}).passthrough()}).passthrough(),i=a.extend({status:r.z.number().int().min(400).max(599),payload:r.z.strictObject({"@type":r.z.literal("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse"),error:r.z.string()})}),c=a.extend({payload:r.z.strictObject({"@type":r.z.literal("type.googleapis.com/google.protobuf.Empty")})}),u={"@type":"type.googleapis.com/google.protobuf.Empty"},l=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},92829:function(e,t,n){n.d(t,{I:function(){return i}});var r=n(7653),s=n(61867),o=n(3286);class a{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=o.qV.safeParse(e.data);if(!n.success){console.warn("Received message does not conform to basic message shape, ignoring");return}let r=n.data;if("response"===r.channel){this.handleResponse(r);return}this.messageQueue.push(r),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId);if(void 0!==t){t(e);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=s.P2.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,r=s.q2.safeParse(e);if(!r.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let a=r.data;if(this.requestLog.has(a.requestId)){this.sendErrorResponse(a.requestId,400,"Request ID already processed");continue}this.requestLog.set(a.requestId,{message:a,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(a.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(a,this.boundSendRequest).then(e=>{var t;let n=o.Tk.parse({channel:"response",status:200,requestId:a.requestId,payload:null!=e?e:o.D7}),r=this.requestLog.get(a.requestId);r&&this.requestLog.set(a.requestId,{...r,response:n,responseTimestamp:new Date().getTime()}),null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var r;let s=o.Kj.parse({channel:"response",status:t,requestId:e,payload:(0,o.v8)(n)}),a=this.requestLog.get(e);a&&this.requestLog.set(e,{...a,response:s,responseTimestamp:new Date().getTime()}),null===(r=this.iframe.contentWindow)||void 0===r||r.postMessage(s,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t){return new Promise((n,r)=>{var a;let i=Date.now().toString();this.inFlightRequests.set(i,e=>{let t=o.Tk.safeParse(e);if(!t.success){r(Error("Invalid response format"));return}let a=t.data;if(a.status>=400){let e=o.Kj.safeParse(a);e.success?r(Error(e.data.payload.error)):r(Error("Error response (".concat(a.status,")")));return}let i=s.O3.safeParse(a);i.success?n(i.data.payload):r(Error("Invalid response payload for the method"))}),null===(a=this.iframe.contentWindow)||void 0===a||a.postMessage({channel:"request",method:e,requestId:i,payload:t},this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:r,onCapabilityAction:s}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=r,this.onCapabilityAction=s,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}function i(e){let{iframeRef:t,allowedOrigin:n,onRateLimited:o=null,initialPermissions:i,onPermissionRequested:c,onCapabilityAction:u}=e,[l,d]=(0,r.useState)(null),p=(0,r.useRef)(i),[h,m]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(!t.current&&h<20){let e=setTimeout(()=>{m(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current){console.warn("Max retries reached while waiting for iframe");return}let e=new a({iframe:t.current,allowedOrigin:n,onRateLimited:o,onPermissionRequested:async e=>{if(s.TD.includes(e)||"accepted"===p.current[e])return"accepted";let t=await c(e);return p.current={...p.current,[e]:t},t},onCapabilityAction:u});return d(e),()=>{e.cleanup()}},[t,n,p,o,c,u,h]);let g=(0,r.useCallback)(async(e,t)=>{if(l)return l.sendRequest(e,t);throw Error("Communicator not initialized")},[l]),f=(0,r.useCallback)(()=>{null==l||l.restartListening()},[l]),y=(0,r.useCallback)((e,t)=>{p.current={...p.current,[e]:t}},[]);return{sendRequest:null===l?void 0:g,restartListening:f,permissions:p.current,updatePermission:y}}},2190:function(e,t,n){n.d(t,{i:function(){return u},s:function(){return c}});var r=n(89992),s=n(24550),o=n(7653);function a(e,t){let n=new Map;return t.forEach(e=>{var t;let r=null!==(t=n.get(e.file_name))&&void 0!==t?t:[];r.push(e),n.set(e.file_name,r)}),n.get(e)}function i(e,t){let n=a(e,t);if(!n||0===n.length)return null;let r=n.filter(e=>e.file_kind===s.Y.Blob);return 0===r.length?null:r[r.length-1]}function c(){let e=function(){let e=(0,r.OJ)();return(0,o.useCallback)(async(t,n,r,s,o)=>{let a=i(t,n);if(!a&&s){let n=await e("/api/organizations/".concat(r,"/projects/").concat(s,"/docs")),o=(await n.json()).find(e=>e.file_name===t);if(o)return new TextEncoder().encode(o.content);let c=await e("/api/organizations/".concat(r,"/projects/").concat(s,"/files"));a=i(t,await c.json())}if(!a)return null;try{let e=o?"/api/organizations/".concat(r,"/shared_artifact/").concat(o,"/files/").concat(a.file_uuid,"/contents"):"/api/organizations/".concat(r,"/files/").concat(a.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let n=await t.arrayBuffer();if(n.byteLength>2147483648-1)return null;return new Uint8Array(n)}catch(e){return null}},[e])}();return(0,o.useCallback)(async(t,n,r,s,o,i)=>s?function(e,t){let n=a(e,t);if(!n||0===n.length)return null;let r=n[n.length-1];if(r){let e=r.extracted_content;return new TextEncoder().encode(e)}return null}(t,n)||await e(t,r,s,o,i):null,[e])}function u(e,t,n,r,s){let a=c();return(0,o.useCallback)(async o=>a(o,e,t,n,r,s),[e,t,n,r,a,s])}},6482:function(e,t,n){n.d(t,{M:function(){return o},T:function(){return s}});var r=n(7653);let s=(0,r.createContext)(null),o=()=>{let e=(0,r.useContext)(s);if(!e)throw Error("usePersistentSandbox must be used within a PersistentSandboxProvider");return e}},57851:function(e,t,n){n.d(t,{McpProvider:function(){return g},c:function(){return m}});var r=n(27573);n(2275);var s=n(21468),o=n(24658),a=n(50400),i=n(49366),c=n(7653),u=n(89992),l=n(88075);i.kO.shape.params;var d=n(57012);class p{start(){return this._port.onmessage=e=>{var t;null===(t=this.onmessage)||void 0===t||t.call(this,e.data)},this._port.onmessageerror=e=>{var t;null===(t=this.onerror)||void 0===t||t.call(this,Error("MessagePort message error: ".concat(e.data)))},Promise.resolve()}close(){var e;return this._port.close(),null===(e=this.onclose)||void 0===e||e.call(this),Promise.resolve()}send(e){return this._port.postMessage(e),Promise.resolve()}constructor(e){this._port=e}}let h=(0,c.createContext)({mcpClients:{},mcpTools:[],isLoading:!1,isEnabled:!1}),m=()=>{let e=(0,c.useContext)(h);return e||console.warn("useMcp being used outside of McpProvider, this is probably a bug"),e};function g(e){let{children:t}=e,[n,a]=(0,c.useState)({}),[p,m]=(0,c.useState)(!1),{addError:g}=(0,o.e)(),{tools:y,onDolphinInterrupted:b}=function(e){let{mcpClients:t}=e,[n,r]=(0,c.useState)([]),a=(0,c.useRef)(!1),u=(0,c.useRef)(null),l=(0,c.useRef)(!1),{addError:p}=(0,o.e)(),{track:h}=(0,s.z$)(),m=(0,c.useCallback)(async(e,n,r)=>{if("auto-dolphin"===e){let e=l.current?'Claude would like to run the tool "'.concat(n.name,'" but was previously interrupted. Do you want to allow this?'):'Claude would like to run the tool "'.concat(n.name,'". Do you want to allow this?');if(a.current&&!confirm(e))return h({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(r).length}),l.current=!0,{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],isError:!0};u.current=Date.now(),a.current=!1}try{let s=await t[e].callTool({name:n.name,arguments:r},i.M$,{timeout:24e4});if(h({event_key:"mcp.tools.called",result:"success",argument_count:Object.keys(r).length}),"content"in s)return s;return{content:[{type:"text",text:JSON.stringify(s.toolResult,null,2)}],isError:!1}}catch(e){throw p("Failed to call tool ".concat(n.name,": ").concat(e)),h({event_key:"mcp.tools.called",result:"failure",argument_count:Object.keys(r).length}),e}},[p,t,h]);return(0,c.useEffect)(()=>{let e=!1;return async function(){if(!t)return;let n=await (0,d.k)(t,{method:"tools/list",params:{}},i.Gd);e||r(Object.entries(n).map(e=>{var t;let[n,r]=e;return h({event_key:"mcp.tools.listed",tool_count_on_server:r.tools.length}),null!==(t=r.tools.map(e=>({...e,serverName:n,callback:t=>m(n,e,t)})))&&void 0!==t?t:[]}).flat())}(),()=>{e=!0}},[m,t,h]),{tools:n,onDolphinInterrupted:(0,c.useCallback)(()=>{if("number"==typeof u.current&&Date.now()<u.current+100)return},[u])}}({mcpClients:n}),{track:x}=(0,s.z$)();!function(e){let{mcpClients:t}=e,{addError:n}=(0,o.e)(),{track:r}=(0,s.z$)(),{activeOrganization:a}=(0,l.t)(),i=(0,u.uC)("/api/organizations/".concat(null==a?void 0:a.uuid,"/dust/mcp_messages"),"POST",{enabled:!1,onError:()=>n("MCP sampling failed")});(0,c.useEffect)(()=>{},[!1,t,i,r])}({mcpClients:n});let v=(0,c.useCallback)(e=>{if(e.source!==window)return;let{type:t,serverName:n}=e.data;if("mcp-server-connected"!==t||!n)return;let[r]=e.ports;f(r).then(e=>{console.log("Connected to MCP server ".concat(n)),a(t=>({...null!=t?t:{},[n]:e})),"dolphin"===n&&e.setNotificationHandler(i.b5,e=>{"USER_INTERRUPT"===e.params.data&&b()}),x({event_key:"mcp.servers.connected",result:"success"})},e=>{console.error("Could not attach to MCP server ".concat(n,":"),e),g("Could not attach to MCP server ".concat(n)),x({event_key:"mcp.servers.connected",result:"failure"})})},[g,x,b]);(0,c.useEffect)(()=>{window.addEventListener("message",v);let e=!1;async function t(){var t,n;if(!(null===(t=window.claudeAppBindings)||void 0===t?void 0:t.listMcpServers)||!(null===(n=window.claudeAppBindings)||void 0===n?void 0:n.connectToMcpServer))return;let r=await window.claudeAppBindings.listMcpServers();x({event_key:"mcp.servers.listed",server_count:r.length}),e||await Promise.all(r.map(e=>window.claudeAppBindings.connectToMcpServer(e).catch(t=>{console.error("Could not connect to MCP server ".concat(e,":"),t),g("Could not connect to MCP server ".concat(e))})))}return m(!0),t().finally(()=>m(!1)),()=>{e=!0,window.removeEventListener("message",v)}},[v,g,x]);let w=(0,c.useMemo)(()=>Object.keys(n).length>0,[n]);return(0,r.jsx)(h.Provider,{value:{mcpClients:n,mcpTools:y,isLoading:p,isEnabled:w},children:t})}async function f(e){let t=new p(e),n=new a.K({name:"claude-ai",version:"0.1.0"},{capabilities:{}});return await t.start(),await n.connect(t),n}},57012:function(e,t,n){n.d(t,{k:function(){return s}});var r=n(49366);async function s(e,t,n,s){return e?Object.fromEntries((await Promise.all(Object.entries(e).map(async e=>{let[o,a]=e;try{let e=await a.request(t,n,{timeout:5e3,...s});return[o,e]}catch(e){if(e instanceof r.yp&&e.code===r.jK.MethodNotFound)return null;return console.error("Request ".concat(t.method," to ").concat(o," failed: ").concat(e)),null}}))).filter(e=>null!==e)):{}}},15489:function(e,t,n){n.d(t,{An:function(){return C},HZ:function(){return R},JP:function(){return s},Km:function(){return x},VA:function(){return p},kE:function(){return l},l2:function(){return v},tE:function(){return S},w0:function(){return z},yc:function(){return d}});var r,s,o,a=n(97712),i=n(92068),c=n(6932);(r=s||(s={})).Text="text/plain",r.Markdown="text/markdown",r.Html="text/html",r.Code="application/vnd.ant.code",r.Svg="image/svg+xml",r.Mermaid="application/vnd.ant.mermaid",r.React="application/vnd.ant.react",(o||(o={})).Repl="application/vnd.ant.repl";let u=a.z.string().nullish().transform(e=>null!=e?e:void 0),l=a.z.object({version_uuid:u,command:a.z.enum(["create","update","rewrite"]).optional().catch(void 0),id:u,title:u,type:a.z.nativeEnum(s).optional().catch(void 0),language:u,content:u,old_str:u,new_str:u}),d={"text/plain":{syntaxName:"plaintext",extension:()=>"txt"},"text/markdown":{syntaxName:"markdown",extension:()=>"md"},"text/html":{syntaxName:"html",extension:()=>"html"},"image/svg+xml":{syntaxName:"svg",extension:()=>"svg"},"application/vnd.ant.code":{syntaxName:"plaintext",extension:e=>{switch(null==e?void 0:e.language){case"python":return"py";case"javascript":return"js";case"typescript":return"ts";case"java":return"java";case"csharp":return"cs";case"go":return"go";case"rust":return"rs";case"ruby":return"rb";case"php":return"php";case"swift":return"swift";case"kotlin":return"kt";case"dart":return"dart";case"scala":return"scala";case"perl":return"pl";case"elixir":return"ex";case"haskell":return"hs";case"clojure":return"clj";case"r":return"r";case"groovy":return"groovy";case"bash":return"sh";case"css":return"css";case"scss":return"scss";case"less":return"less";case"sql":return"sql";case"graphql":return"graphql";case"json":return"json";case"html":return"html";default:return"txt"}}},"application/vnd.ant.mermaid":{syntaxName:"mermaid",extension:()=>"mermaid"},"application/vnd.ant.react":{syntaxName:"tsx",extension:()=>"tsx"}},p=e=>{let t=d[e.type];return"application/vnd.ant.code"!==e.type?t.extension():t.extension(e)},h="antArtifact",m="<".concat(h,"(?:\\s+([^>]*)>|(?!>)\\S*)"),g="</".concat(h,">"),f=RegExp("".concat(m,"([\\s\\S]*?)(?:").concat(g,"|$)"),"g"),y=RegExp("<(?:a(?:n(?:t(?:A(?:r(?:t(?:i(?:f(?:a(?:c(?:t)?)?)?)?)?)?)?)?)?)?)?$","gm"),b=RegExp("".concat(m,"[\\s\\S]*?(?:").concat(g,"|$)"),"g"),x="ANTARTIFACTLINK";function v(e){var t;let n=e.match(/identifier="([^"]*)"/),r=n?n[1]:"",o=e.match(/type="([^"]*)"/),a=o?(t=o[1],Object.values(s).includes(t)?t:"text/plain"):"text/plain",i=e.match(/title="([^"]*)"/),c=i?i[1]:"Untitled artifact",u=e.match(/language="([^"]*)"/),l=u?u[1]:void 0,d=e.match(/isClosed="(true|false)"/);return{id:r,type:a,title:c,language:l,isClosed:d?"true"===d[1]:void 0}}function w(e){return e.replace(y,"")}function z(e){return k(w(e)).replace(f,(e,t,n)=>{if(!t||"string"!=typeof t)return"";{let{type:e,language:r}=v(t);return"text/markdown"!==e&&"string"==typeof n?"```".concat(r||d[e].syntaxName,"\n").concat(n.trimStart(),"\n```"):"\n".concat(n)}})}function C(e){return w(k(e).replace(b,(e,t)=>{let n=e.endsWith(g);return"<".concat(x," ").concat(t,' isClosed="').concat(n,'" />')}))}let S=(e,t)=>"create"===e.command||"rewrite"===e.command?e.content:"update"===e.command?void 0===t?e.new_str:t.includes(e.old_str)?t.replace(e.old_str,e.new_str):t.replace(e.old_str.trim(),e.new_str):null!=t?t:"";function R(e){var t;let n=(0,i.K)(e).matchAll(f),r=[];for(let t of n){let[n,s,o]=t,a=n.endsWith(g);if(!s||!o)continue;let{id:i,type:c,title:u,language:l}=v(s),d={command:"create",message:e.uuid||"",created_at:e.created_at,content:o.trimStart(),isClosed:a};r.push({id:i,currentVersion:d,type:c,title:u,language:l})}return null===(t=e.content)||void 0===t||t.map((t,n,s)=>{if("tool_use"===t.type&&"artifacts"===t.name&&t.input){let o;let a=(0,c.n)(t),i=n===s.length-1,{version_uuid:u,command:d,id:p,type:h="text/plain",title:m="",language:g,content:f="",old_str:y="",new_str:b=""}=l.parse(a);"create"===d||"rewrite"===d?o={uuid:u,command:d,message:e.uuid||"",created_at:e.created_at,content:f.trimStart(),isClosed:!i}:"update"===d&&""!==f?o={uuid:u,command:"rewrite",message:e.uuid||"",created_at:e.created_at,isClosed:!i,content:f}:"update"===d&&(o={uuid:u,command:"update",message:e.uuid||"",created_at:e.created_at,isClosed:!i,old_str:y,new_str:b}),void 0!==p&&void 0!==o&&r.push({id:p,currentVersion:o,type:h,title:m,language:g})}}),r}let q="antThinking",E="<".concat(q,">"),_=RegExp("".concat(E,"[\\s\\S]*?(?:</").concat(q,">|$)"),"g"),j=RegExp("<(?:a(?:n(?:t(?:T(?:h(?:i(?:n(?:k(?:i(?:n(?:g)?)?)?)?)?)?)?)?)?)?)?$","gm");function k(e){return e.replace(j,"").replace(_,"")}},24550:function(e,t,n){var r,s;n.d(t,{Y:function(){return r}}),(s=r||(r={})).Image="image",s.Blob="blob",s.SanitizedDocument="document"},90216:function(e,t,n){n.d(t,{g:function(){return r}});function r(e){let t=function(e){let t=[],n=0;for(;n<e.length;){let r=e[n];if(/\s/.test(r)){n++;continue}if("{[]}:,".includes(r)){t.push(r),n++;continue}if('"'===r){let s=r;n++;let o=!1,a=!1;for(;n<e.length;){if(s+=r=e[n],'"'===r&&!o){a=!0;break}o="\\"===r&&!o,n++}if(!a){if(s.slice(-5).includes("\\"))for(s=s.slice(0,s.lastIndexOf("\\"));s.endsWith("\\");)s=s.slice(0,-1);s+='"'}t.push(s),n++;continue}if(/[-0-9]/.test(r)){let r="";for(;n<e.length&&/[-0-9.eE+]/.test(e[n]);)r+=e[n],n++;if(!r.match(/\d$/))for(;r.length>0&&!r[r.length-1].match(/\d/);)r=r.slice(0,-1);t.push(r);continue}if(/[tfn]/.test(r)){let s="",o=["true","false","null"],a=o.filter(e=>e.startsWith(r));if(1===a.length)n+=(s=a[0]).length;else for(;n<e.length&&/[a-z]/.test(e[n])&&(s+=e[n],n++,!o.includes(s)););o.includes(s)&&t.push(s);continue}n++}return t}(e),n=[];for(let e of t)"{"===e||"["===e?n.push("{"===e?"}":"]"):("}"===e||"]"===e)&&n.length>0&&n.pop();n.reverse(),","===t[t.length-1]&&t.pop();let r=t.concat(n).join("");if(""===r)return null;try{return JSON.parse(r)}catch(r){let e=Math.max(t.lastIndexOf(","),t.lastIndexOf("{"),t.lastIndexOf("["));if(-1!==e){let r=t.slice(0,e+1);return","===r[r.length-1]&&r.pop(),JSON.parse(r.concat(n).join(""))}throw Error("Invalid JSON")}}},6932:function(e,t,n){n.d(t,{n:function(){return s}});var r=n(90216);let s=e=>{if(e.input&&Object.keys(e.input).length>0)return e.input;if(e.partial_json){let t={};try{t=(0,r.g)(e.partial_json)}catch(e){}return null!=t?t:{}}return{}}}}]);